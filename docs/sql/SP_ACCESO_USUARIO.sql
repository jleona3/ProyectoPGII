-- ✅ Versión final con estado fijo en 1
CREATE PROCEDURE SP_L_USUARIO_03
    @EMAIL VARCHAR(150),
    @PASS VARBINARY(150)
AS
BEGIN
    SELECT
        U.ID_USER,
        U.ID_APTO,
        U.EMAIL,
        U.PASS,
        U.NOMBRES,
        U.APELLIDOS,
        U.DPI,
        U.TELEFONO,        
        U.FOTO_PERFIL,
        U.ID_ESTADO,
        U.ROL_ID,
        C.NUM_TORRE,
        C.NIVEL, 
        E.CODIGO,
        E.DESCRIPCION,
        R.ROL_NOM,
        R.ESTADO
    FROM 
        TRZ6_USUARIO U
        INNER JOIN TRZ6_CONDOMINIO C ON U.ID_APTO = C.ID_APTO
        INNER JOIN TRZ6_CAT_ESTADO E ON U.ID_ESTADO = E.ID_ESTADO AND C.ID_ESTADO = E.ID_ESTADO
        INNER JOIN TRZ6_ROL R ON U.ROL_ID = R.ROL_ID
    WHERE
        U.ID_ESTADO = 1
        AND U.EMAIL = @EMAIL
        AND U.PASS = @PASS
END
GO

/*SE ELIMINA EL CAMPO CODIGO POR EL CAMPO CREADO POR */
ALTER PROCEDURE SP_L_USUARIO_03
    @EMAIL VARCHAR(150),
    @PASS VARCHAR(150)
AS
BEGIN
    SELECT
        U.ID_USER,
        U.ID_APTO,
        U.EMAIL,
        U.NOMBRES,
        U.APELLIDOS,
        U.DPI,
        U.TELEFONO,
        U.PASS, 
        U.FOTO_PERFIL,
        U.ID_ESTADO,
        U.ROL_ID,
        C.NUM_TORRE,
        C.NIVEL, 
        E.DESCRIPCION,
        E.CREADO_POR,
        R.ROL_NOM,
        R.ESTADO
    FROM 
        TRZ6_USUARIO U
        INNER JOIN TRZ6_CONDOMINIO C ON U.ID_APTO = C.ID_APTO
        INNER JOIN TRZ6_CAT_ESTADO E ON U.ID_ESTADO = E.ID_ESTADO AND C.ID_ESTADO = E.ID_ESTADO
        INNER JOIN TRZ6_ROL R ON U.ROL_ID = R.ROL_ID
    WHERE
        U.ID_ESTADO = 1
        AND U.EMAIL = @EMAIL
        AND U.PASS = @PASS
END
GO